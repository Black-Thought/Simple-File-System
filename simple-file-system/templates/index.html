<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Simple File System Visualizer</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
body {font-family:sans-serif;background:#f5f5f5;margin:0;text-align:center;}
h1{margin:10px 0;}
nav{margin:10px;}
button{margin:0 5px;padding:6px 14px;border:0;border-radius:6px;cursor:pointer;}
#viz,#graph{display:flex;justify-content:center;flex-wrap:wrap;margin:10px auto;max-width:900px;}
.block{width:20px;height:20px;margin:1px;border-radius:3px;cursor:pointer;}
.super{background:#e74c3c;}      /* red   */
.inode{background:#f39c12;}      /* orange*/
.data_used{background:#2ecc71;}  /* green */
.indirect{background:#3498db;}   /* blue  */
.data_free{background:#bdc3c7;}  /* grey  */
.tooltip{position:absolute;background:white;border:1px solid #ccc;
  padding:4px 8px;border-radius:4px;font-size:12px;pointer-events:none;}
svg{width:900px;height:500px;margin:auto;}
line{stroke:#999;stroke-width:1.5px;}
circle{stroke:#333;stroke-width:1px;}
</style>
</head>
<body>
<h1>ðŸ§© Simple File System Visualizer</h1>
<nav>
  <button id="btn-map">Disk Map</button>
  <button id="btn-graph">Inode Graph</button>
</nav>
<div id="viz"></div>
<svg id="graph" style="display:none"></svg>
<div id="tooltip" class="tooltip" style="opacity:0"></div>

<script>
const tooltip=d3.select("#tooltip");

function showTooltip(evt,text){
  tooltip.transition().duration(100).style("opacity",1);
  tooltip.html(text)
    .style("left",(evt.pageX+10)+"px")
    .style("top",(evt.pageY-20)+"px");
}
function hideTooltip(){tooltip.transition().duration(200).style("opacity",0);}

d3.json("/data").then(data=>{
  if(data.error){d3.select("#viz").append("p").text("Error: "+data.error);return;}

  /* -------  Disk-map view  ------- */
  const viz=d3.select("#viz");
  viz.selectAll(".block")
    .data(data.blocks)
    .enter().append("div")
    .attr("class",d=>"block "+d.type)
    .on("mouseover",(e,d)=>showTooltip(e,`Block ${d.id}<br>Type: ${d.type}`))
    .on("mouseout",hideTooltip);

  /* -------  Graph view  ------- */
  const nodes=[],links=[];
  data.blocks.forEach(b=>{
    if(b.type==="inode"||b.type==="data_used"||b.type==="indirect")
      nodes.push({id:b.id,type:b.type});
  });
  // simple synthetic linkage: each inode connects to next few data blocks
  for(let i=0;i<nodes.length;i++){
    if(nodes[i].type==="inode"){
      for(let j=i+1;j<i+4 && j<nodes.length;j++)
        if(nodes[j].type!=="inode")
          links.push({source:nodes[i].id,target:nodes[j].id});
    }
  }
  const svg=d3.select("#graph");
  const color=d=>({super:"#e74c3c",inode:"#f39c12",data_used:"#2ecc71",
                   indirect:"#3498db",data_free:"#bdc3c7"}[d.type]||"#999");
  const sim=d3.forceSimulation(nodes)
      .force("link",d3.forceLink(links).id(d=>d.id).distance(80))
      .force("charge",d3.forceManyBody().strength(-200))
      .force("center",d3.forceCenter(450,250));

  const link=svg.append("g").selectAll("line")
      .data(links).enter().append("line");
  const node=svg.append("g").selectAll("circle")
      .data(nodes).enter().append("circle")
      .attr("r",10).attr("fill",d=>color(d))
      .on("mouseover",(e,d)=>showTooltip(e,`Block ${d.id}<br>Type: ${d.type}`))
      .on("mouseout",hideTooltip)
      .call(d3.drag()
        .on("start",d=>{if(!d.active)sim.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;})
        .on("drag",d=>{d.fx=d3.event.x;d.fy=d3.event.y;})
        .on("end",d=>{if(!d.active)sim.alphaTarget(0);d.fx=null;d.fy=null;}));
  sim.on("tick",()=>{
      link.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y)
          .attr("x2",d=>d.target.x).attr("y2",d=>d.target.y);
      node.attr("cx",d=>d.x).attr("cy",d=>d.y);
  });

  /* -------  View-toggle buttons  ------- */
  d3.select("#btn-map").on("click",()=>{
    d3.select("#viz").style("display","flex");
    d3.select("#graph").style("display","none");
  });
  d3.select("#btn-graph").on("click",()=>{
    d3.select("#viz").style("display","none");
    d3.select("#graph").style("display","block");
  });
});
</script>
</body>
</html>
